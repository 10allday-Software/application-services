<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Redash · Firefox Application Services</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h3&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;table-described&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#table-described&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Table Described&lt;/h3&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Redash · Firefox Application Services"/><meta property="og:type" content="website"/><meta property="og:url" content="https://mozilla.github.io/application-services/index.html"/><meta property="og:description" content="&lt;h3&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;table-described&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#table-described&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Table Described&lt;/h3&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/application-services/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://mozilla.github.io/application-services/blog/atom.xml" title="Firefox Application Services Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://mozilla.github.io/application-services/blog/feed.xml" title="Firefox Application Services Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/application-services/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/application-services/"><img class="logo" src="/application-services/img/app-services.svg" alt="Firefox Application Services"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/application-services/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/mozilla/application-services" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Team</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Firefox Sync</h3><ul><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/welcome.html">Welcome</a></li><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/file-desktop-bug.html">Filing a Desktop bug</a></li><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/faq.html">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Testing</h3><ul><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/tps.html">TPS</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Design Docs</h3><ul><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/extension-storage.html">Extension Storage</a></li><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/state-machines.html">State Machines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Team</h3><ul><li class="navListItem"><a class="navItem" href="/application-services/docs/sync/canned-bug-responses.html">Canned Bug Responses</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/application-services/docs/sync/redash.html">Redash</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Redash</h1></header><article><div><span><h3><a class="anchor" aria-hidden="true" id="table-described"></a><a href="#table-described" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Table Described</h3>
<p>The Sync team's telemetry goes through our data pipeline and lands in
Presto to be explored in <a href="https://sql.telemetry.mozilla.org/">Redash</a>.
Below is a description of the data available in the <strong>sync_summary</strong>
table. Further documentation on this data is available <a href="https://github.com/mozilla/telemetry-batch-view/blob/master/docs/SyncSummary.md">in the
telemetry-batch-view
repo</a>,
and in the <a href="http://gecko.readthedocs.io/en/latest/toolkit/components/telemetry/telemetry/data/sync-ping.html">general sync ping
documentation</a>.</p>
<table>
<thead>
<tr><th>Field Names</th><th>Data Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>app_build_id</td><td>varchar</td><td>Firefox build ID (e.g. 20160801085519)</td></tr>
<tr><td>app_version</td><td>varchar</td><td>Firefox version (e.g. 50.0a2) - corresponds to the MOZ_APP_VERSION configure value</td></tr>
<tr><td>app_display_version</td><td>varchar</td><td>The application version as shown in the about dialog. Almost always identical to app_version. Corresponds to the MOZ_APP_VERSION_DISPLAY configure value.</td></tr>
<tr><td>app_name</td><td>varchar</td><td>Will always be the string &quot;Firefox&quot; in desktop submitted pings.</td></tr>
<tr><td>app_channel</td><td>varchar</td><td>The update channel (e.g. &quot;release&quot;, &quot;nightly&quot;, etc) - corresponds to the MOZ_UPDATE_CHANNEL config variable.</td></tr>
<tr><td>uid</td><td>varchar</td><td>Hashed Sync/FxA ID</td></tr>
<tr><td>deviceid</td><td>varchar</td><td>Hashed FxA device ID.</td></tr>
<tr><td>when</td><td>bigint</td><td>Unix timestamp of when sync occurred. Make sure to put in &quot;quotes&quot; since when is a reserved SQL word. Note that because this is taken from the client's clock, the time may be wildly inaccurate.</td></tr>
<tr><td>took</td><td>bigint</td><td>Number of milli-seconds it took to Sync.</td></tr>
<tr><td>failure_reason</td><td>row(name varchar, value varchar)</td><td>Sync failure reason, or null if no failure.</td></tr>
<tr><td>status</td><td>row(sync varchar, service varchar)</td><td>The status of sync after completion, or null is both statuses record success.</td></tr>
<tr><td>why</td><td>varchar</td><td>Currently always null, but eventually should be the reason the sync was performed (eg, timer, button press, score update, etc)</td></tr>
<tr><td>devices</td><td>array(row(id varchar, os varchar, version varchar))</td><td>Array of the other devices in this user's device constellation.</td></tr>
<tr><td>engines</td><td>array(engine_record)</td><td>A record of the engines that synced. Each element of the array is in the format of an <a href="#engine-record">engine record</a>.</td></tr>
<tr><td>submission_date_s3</td><td>varchar</td><td>The date this ping was submitted to the telemetry servers. Because a ping will typically be sent for a previous session immediately after a browser restart, this submission date may be later than the date recorded in the ping. Note also that this is a timestamp supplied by the server so is likely to be more reliable than the dates recorded in the ping itself.</td></tr>
</tbody>
</table>
<h4><a class="anchor" aria-hidden="true" id="engine-record"></a><a href="#engine-record" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Engine Record</h4>
<p>An engine record is defined as:</p>
<table>
<thead>
<tr><th>Field Name</th><th>Data Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>name</td><td>varchar</td><td>The name of the engine.</td></tr>
<tr><td>took</td><td>bigint</td><td>How many milliseconds this engine took to sync.</td></tr>
<tr><td>status</td><td>varchar</td><td>The status of this engine after sync completed, or null is the status reflects success.</td></tr>
<tr><td>failure_reason</td><td>row(name varchar, value varchar)</td><td>Details of any errors recorded during the sync of this engine, or null on success.</td></tr>
<tr><td>incoming</td><td>row(applied bigint, failed bigint, newFailed bigint, reconciled bigint)</td><td>Details of how many incoming records were applied, failed, failed for the first time in this sync, and reconciled.</td></tr>
<tr><td>outgoing</td><td>array(row(sent bigint, failed bigint)))</td><td>For each batch of records uploaded as part of a Sync, how many records were sent in that batch and how many failed.</td></tr>
<tr><td>validation</td><td>validation_record</td><td>Validation information for this engine. Null if validation cannot or did not run during this sync (common). If present, it's format is of a <a href="#validation_record">validation record</a></td></tr>
</tbody>
</table>
<h5><a class="anchor" aria-hidden="true" id="validation-record"></a><a href="#validation-record" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Validation Record</h5>
<p>A validation record is defined as:</p>
<table>
<thead>
<tr><th>Field Name</th><th>Data Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>version</td><td>bigint</td><td>Version of the validator used to get this data.</td></tr>
<tr><td>checked</td><td>bigint</td><td>Number of records the validator checked in this engine.</td></tr>
<tr><td>took</td><td>bigint</td><td>How long validation took for this engine.</td></tr>
<tr><td>problems</td><td>array(row(name varchar, count varchar))</td><td>The problems identified. Problems with a count of 0 are excluded. Null on failure or if no problems occurred.</td></tr>
<tr><td>failure_reason</td><td>row(name varchar, value varchar)</td><td>Details of any errors recorded during the validation, or null if validation succeeded.</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="faq"></a><a href="#faq" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FAQ</h3>
<p>Q1: In <strong>engines</strong>, we have <strong>status</strong> and <strong>failureReason</strong>, how are
they different from the columns with the same names?</p>
<p>A1: These are the exceptions and status for the engine itself, whereas
the columns at the top-level of the table are for the entire sync. The
error handling should be cleaned up, but in general, <strong>failureReason</strong>
will be reporting bugs, whereas &quot;status&quot; is reporting when we explicitly
decided that we couldn't apply a record.</p>
<hr>
<p>Q2: Do we only log the <strong>engines</strong> array when we see
&quot;service&quot;:&quot;error.sync.failed_partial&quot; in <strong>status</strong>?</p>
<p>A2: I don't think that's true - eg, &quot;select * from sync_summary where
engines is not null and status is null limit 10&quot; shows records.</p>
<hr>
<p>Q3: What values are valid in the validation record's <strong>name</strong> field?</p>
<p>A3: It's up to the engine and to the client. For desktop bookmarks,
they're documented
<a href="https://dxr.mozilla.org/mozilla-central/source/services/sync/modules/bookmark_validator.js">here</a>
(or
<a href="https://dxr.mozilla.org/mozilla-central/rev/1d025ac534a6333a8170a59a95a8a3673d4028ee/services/sync/modules/bookmark_validator.js#27-68">here</a>
if that link breaks).</p>
<h3><a class="anchor" aria-hidden="true" id="event-telemetry"></a><a href="#event-telemetry" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event Telemetry</h3>
<p>Sync will often write &quot;events&quot; to telemetry. These are made available
via the sync_events_v1 table.</p>
<h4><a class="anchor" aria-hidden="true" id="table-description"></a><a href="#table-description" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Table Description</h4>
<table>
<thead>
<tr><th>Field Names</th><th>Data Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>document_id</td><td>varchar</td><td>The document ID of the original ping this event is from.</td></tr>
<tr><td>app_build_id</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>app_display_version</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>app_name</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>app_version</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>app_channel</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>uid</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>why</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>deviceId</td><td>varchar</td><td>From the original ping</td></tr>
<tr><td>event_timestamp</td><td>bigint</td><td>Number of milliseconds since the process started when the event was created. (??)</td></tr>
<tr><td>event_category</td><td>varchar</td><td>Always the string &quot;sync&quot;</td></tr>
<tr><td>event_method</td><td>varchar</td><td>The type of action taken on the object</td></tr>
<tr><td>event_object</td><td>varchar</td><td>The type of object being acted on</td></tr>
<tr><td>event_string_value</td><td>varchar</td><td>Additional data</td></tr>
<tr><td>event_map_values</td><td>map(varchar, varchar)</td><td>Additional data specific to this event.</td></tr>
<tr><td>event_flow_id</td><td>varchar</td><td>An ID used to identify a pair of commands which span multiple devices (todo: explain this!)</td></tr>
<tr><td>event_device_id</td><td>varchar</td><td>If this event is being targeted at a different sync device, this is the ID of the target.</td></tr>
<tr><td>event_device_version</td><td>varchar</td><td>If this event is being targeted at a different sync device, this is the Firefox version it is running.</td></tr>
<tr><td>event_device_os</td><td>varchar</td><td>If this event is being targeted at a different sync device, this is the OS it is running</td></tr>
<tr><td>submission_date_s3</td><td>varchar</td><td>The date this ping was submitted.</td></tr>
</tbody>
</table>
<h4><a class="anchor" aria-hidden="true" id="event-usage"></a><a href="#event-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event Usage</h4>
<h5><a class="anchor" aria-hidden="true" id="commands-sent-between-clients"></a><a href="#commands-sent-between-clients" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Commands sent between clients</h5>
<p>Sometimes Sync will send a &quot;command&quot; from one device to another. The
most obvious example of this is &quot;send tab&quot;. Event telemetry is recorded
both by the sending device and the receiving device.</p>
<p>In all cases, the sending device will create a unique &quot;flowID&quot; which
will appear in event_flow_id, and it will send this value as part of
the command. The device receiving the command will record this flow ID
in the event it creates - so both the sending and receiving device will
record the same flowID.</p>
<p>In all cases, the sending device will record in the event the ID of the
device that is to receive the command. However, the receiving device
does not record the device that sent the command.</p>
<p>The sending device will record: event_object=&quot;sendcommand&quot;,
event_method will be the specific command being sent (eg, &quot;displayURI&quot;
for sendTab).</p>
<p>The receiving device will record: event_object=&quot;processcommand&quot;,
event_method will be the command being sent.</p>
<h5><a class="anchor" aria-hidden="true" id="commands-sent-by-the-repair-process"></a><a href="#commands-sent-by-the-repair-process" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Commands sent by the repair process</h5>
<p>Bookmark repair is fairly chatty when it comes to events - both the
device initiating the repair and any other devices participating in the
repair process record events, and they all use the same flowID - so it
should be possible to reconstruct the repair process by looking for all
events with the same flow ID.</p>
<p>The general repair process is:</p>
<ol>
<li>One device finds problems and starts a repair. It emits an event
event_object=&quot;repair&quot;, event_method=&quot;started&quot;.</li>
<li>It then attempts to find other devices able to help with the repair
<ul>
<li>if it finds any, it will emit event_object=&quot;repair&quot;,
event_method=&quot;request&quot;, event_string_value=&quot;upload&quot;, and includes
the device ID of the device it wants to respond - and waits.</li>
</ul></li>
<li>Hopefully the other device will see the repair request. If it finds
any objects it can upload, it will emit an event
event_object=&quot;repairResponse&quot;, event_method=&quot;uploading&quot;.</li>
<li>Once the upload is complete, it will write an event
event_object=&quot;repairResponse&quot;, event_method=&quot;finished&quot;.</li>
<li>If the repair responder fails for some reason, it will emit
event_object=&quot;repairResponse&quot;, event_method=&quot;failed&quot; or &quot;aborted&quot;</li>
<li>If initial device that sent the repair request doesn't see a
response from the other device it will emit event_object=&quot;repair&quot;,
event_method=&quot;silent&quot;. If the other device disappears completely,
it will write event_object=&quot;repair&quot;, event_method=&quot;missing&quot;.</li>
<li>The initial device will then check to see if it is still missing
items, and if so, attempt to find a new client. If it can, it jumps
back to (2) above.</li>
<li>The initial device will eventually run out of clients, or will find
all of its IDs. At that time it will emit event_object=&quot;repair&quot;,
event_method=&quot;finished&quot; - or if it gives up due to some error it
will emit event_object=&quot;repair&quot;, event_method=&quot;failed&quot;</li>
</ol>
<p>whew! So in summary:</p>
<ul>
<li>every repair should emit event_object=&quot;repair&quot;,
event_method=&quot;started&quot; as it starts, and either
event_object=&quot;repair&quot;, event_method=&quot;finished/failed&quot; as the last
event.</li>
<li>There may be any number of repairResponse events written (including
zero events if there are no suitable devices). Each of these should
result in a event_object=&quot;repairResponse&quot;,
event_method=&quot;finished/aborted&quot;</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="bookmark-validation-data-roll-ups"></a><a href="#bookmark-validation-data-roll-ups" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bookmark Validation Data Roll-ups</h3>
<h4><a class="anchor" aria-hidden="true" id="telemetrysync-bmk-total-per-day"></a><a href="#telemetrysync-bmk-total-per-day" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>telemetry.sync_bmk_total_per_day</h4>
<p>This table is a roll-up of all bookmark validations (success and
failures).</p>
<p>This table is useful to calculate rates in conjunction with the
<em>telemetry.sync_bmk_validation_problems</em> table.</p>
<table>
<thead>
<tr><th>Column name</th><th>Data format</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>sync_day</td><td>integer (e.g. 20170518)</td><td>The day we ran validation on the user</td></tr>
<tr><td>total_bookmark_validations</td><td>integer</td><td>Number of times we ran bookmark validation per day. This includes successful validations.</td></tr>
<tr><td>total_validated_users</td><td>integer</td><td>Number of users we ran bookmark validation on for each day.</td></tr>
<tr><td>total_bookmarks_checked</td><td>integer</td><td>Number of bookmarks we checked for validation problems.</td></tr>
<tr><td>run_start_date</td><td>integer</td><td>Date we imported the data to Presto.</td></tr>
</tbody>
</table>
<h4><a class="anchor" aria-hidden="true" id="telemetrysync-bmk-validation-problems"></a><a href="#telemetrysync-bmk-validation-problems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>telemetry.sync_bmk_validation_problems</h4>
<p>This table has a row for every validation problem detected during
validation.</p>
<p><strong>Example:</strong> If a user has 4 different validation problems, we will log
each problem in their own row.</p>
<p><strong>Logic used for format:</strong> This choice was made to avoid having endless
amounts of columns representing each validation problem checked (which
would mostly all be null) and to avoid having to add columns as we
detect new types of validation problems.</p>
<table>
<thead>
<tr><th>Field name</th><th>Data type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>app_build_id</td><td>varchar</td><td>Firefox build ID (e.g. 20160801085519)</td></tr>
<tr><td>app_version</td><td>varchar</td><td>Firefox version (e.g. 50.0a2) - corresponds to the MOZ_APP_VERSION configure value</td></tr>
<tr><td>app_display_version</td><td>varchar</td><td>The application version as shown in the about dialog. Almost always identical to app_version. Corresponds to the MOZ_APP_VERSION_DISPLAY configure value.</td></tr>
<tr><td>app_name</td><td>varchar</td><td>Will always be the string &quot;Firefox&quot; in desktop submitted pings.</td></tr>
<tr><td>app_channel</td><td>varchar</td><td>The update channel (e.g. &quot;release&quot;, &quot;nightly&quot;, etc) - corresponds to the MOZ_UPDATE_CHANNEL config variable.</td></tr>
<tr><td>uid</td><td>varchar</td><td>Hashed Sync/FxA ID</td></tr>
<tr><td>deviceid</td><td>varchar</td><td>Hashed FxA device ID.</td></tr>
<tr><td>submission_day</td><td>integer</td><td>Date data was added to Presto (e.g. 20170324)</td></tr>
<tr><td>sync_day</td><td>integer</td><td>Date of sync. (e.g. 20170320)</td></tr>
<tr><td>when</td><td>bigint</td><td>Unix timestamp of when sync occurred. Make sure to put in &quot;quotes&quot; since when is a reserved SQL word. Note that because this is taken from the client's clock, the time may be wildly inaccurate.</td></tr>
<tr><td>status</td><td>row(sync varchar, service varchar)</td><td>The status of sync after completion, or null is both statuses record success.</td></tr>
<tr><td>engine_name</td><td>varchar</td><td>Should always be <strong>bookmarks</strong> in this table.</td></tr>
<tr><td>engine_status</td><td>varchar</td><td>The status of this engine after sync completed, or null if the status reflects success.</td></tr>
<tr><td>engine_failure_reason</td><td>row(name varchar, value varchar)</td><td>Details of any errors recorded during the sync of this engine, or null on success.</td></tr>
<tr><td>engine_has_problems</td><td>true/false</td><td>engine_has_problems is always going to be true in sync_bmk_validation_problems. Used to filter results out of all_engine_validation_results</td></tr>
<tr><td>engine_validation_version</td><td>integer</td><td>Version of the validator used to get this data.</td></tr>
<tr><td>engine_validation_checked</td><td>bigint</td><td>Number of records the validator checked in this engine.</td></tr>
<tr><td>engine_validation_took</td><td>bigint</td><td>How long validation took for this engine.</td></tr>
<tr><td>engine_validation_problem_name</td><td>varchar</td><td>Name of error recorded during the validation. Will never be null since this table only includes validation problems.</td></tr>
<tr><td>engine_validation_problem_count</td><td>integer</td><td>Number of bookmarks afflicted by the problem during the validation check.</td></tr>
<tr><td>run_start_date</td><td>integer</td><td>Date added to presto. (e.g. 20170331)</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="query-examples"></a><a href="#query-examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query Examples</h3>
<p>The example below demonstrates how to select data in JSON object.</p>
<pre><code class="hljs css language-sql"><span class="hljs-keyword">WITH</span> <span class="hljs-keyword">errors</span> <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span>
    failurereason.name <span class="hljs-keyword">AS</span> <span class="hljs-keyword">name</span>,
    failurereason.value <span class="hljs-keyword">AS</span> <span class="hljs-keyword">value</span>
  <span class="hljs-keyword">FROM</span> sync_summary
  <span class="hljs-keyword">WHERE</span> failurereason <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
)
<span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">name</span>,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">value</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">errors</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span>
</code></pre>
<p>The next example shows how to handle unix time stamps and how to use the
Redash date picker. It's important to either cast the date or to use
the type constructor like below or you won't be able to use any
operators on the date which is required for the date picker.</p>
<pre><code class="hljs css language-sql"><span class="hljs-keyword">WITH</span> syncs <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span>
        <span class="hljs-comment">/* convert date from unix timestamp */</span>
        date_trunc(<span class="hljs-string">'day'</span>, from_unixtime(<span class="hljs-string">"when"</span>/<span class="hljs-number">1000</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">day</span>,
        status.service <span class="hljs-keyword">AS</span> service
    <span class="hljs-keyword">FROM</span>
        sync_summary
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">day</span>, <span class="hljs-keyword">status</span>, volume
<span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">day</span>,
    <span class="hljs-string">'success'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">status</span>,
    <span class="hljs-keyword">SUM</span>(
      <span class="hljs-keyword">CASE</span>
      <span class="hljs-keyword">WHEN</span> service <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
      <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
      <span class="hljs-keyword">END</span>
    ) <span class="hljs-keyword">AS</span> volume
  <span class="hljs-keyword">FROM</span> syncs
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">day</span>
  <span class="hljs-keyword">UNION</span> ALL
  <span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">day</span>,
    <span class="hljs-string">'failed'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">status</span>,
    <span class="hljs-keyword">SUM</span>(
      <span class="hljs-keyword">CASE</span>
      <span class="hljs-keyword">WHEN</span> service <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
      <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
      <span class="hljs-keyword">END</span>
    ) <span class="hljs-keyword">AS</span> volume
  <span class="hljs-keyword">FROM</span> syncs
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">day</span>
)
<span class="hljs-comment">/* date picker */</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">day</span> &gt;= <span class="hljs-built_in">timestamp</span> <span class="hljs-string">'{{start_date}}'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">day</span> &lt;= <span class="hljs-built_in">timestamp</span> <span class="hljs-string">'{{end_date}}'</span>

<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>
</code></pre>
<p>This example is how you would unpack the engines array into it's own
table to then query:</p>
<pre><code class="hljs css language-sql"><span class="hljs-keyword">WITH</span> engine_errors <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span>
    uid,
    date_trunc(<span class="hljs-string">'day'</span>, from_unixtime(<span class="hljs-string">"when"</span>/<span class="hljs-number">1000</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span>,
    <span class="hljs-keyword">engine</span>
  <span class="hljs-keyword">FROM</span> sync_summary
<span class="hljs-comment">/* The CROSS JOIN UNNEST will join the array to each row */</span>
  <span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">UNNEST</span>(<span class="hljs-keyword">engines</span>) <span class="hljs-keyword">AS</span> t (<span class="hljs-keyword">engine</span>)
  <span class="hljs-comment">--LIMIT 1000000</span>
)
<span class="hljs-keyword">SELECT</span>
    engine.name <span class="hljs-keyword">AS</span> engine_name,
    <span class="hljs-keyword">SUM</span>(
      <span class="hljs-keyword">CASE</span>
      <span class="hljs-keyword">WHEN</span> engine.failureReason <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
      <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
      <span class="hljs-keyword">END</span>
    ) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">errors</span>
<span class="hljs-keyword">FROM</span> engine_errors
<span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">date</span> &gt;= <span class="hljs-built_in">timestamp</span> <span class="hljs-string">'{{start_date}}'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &lt;= <span class="hljs-built_in">timestamp</span> <span class="hljs-string">'{{end_date}}'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> engine.name
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/application-services/docs/sync/canned-bug-responses.html"><span class="arrow-prev">← </span><span>Canned Bug Responses</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="productShowcaseSection nav-footer" id="footer"><section class="sitemap"><div><a href="https://mozilla.org"><img src="/application-services/img/mozilla.svg" style="height:50px" alt="Mozilla"/></a></div><div><h5>Links</h5><a href="/application-services/blog">Blog</a><a href="/application-services/docs/accounts/welcome.html">Firefox Accounts Docs</a><a href="/application-services/docs/applications/welcome.html">Firefox Applications Docs</a><a href="/application-services/docs/sync/welcome.html">Firefox Sync Docs</a></div><div><h5>More</h5><a href="https://github.com/mozilla/application-services">mozilla/application-services</a><a href="https://github.com/mozilla/fxa">mozilla/fxa</a><a href="https://github.com/mozilla">github/mozilla</a><a href="https://github.com/mozilla-services">github/mozilla-services</a></div></section><section class="copyright">Firefox Application Services</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ebf54a0a9357f70ba426ce54714676d4',
                indexName: 'application_services',
                inputSelector: '#search_input_react'
              });
            </script></body></html>